#!/usr/bin/env sh

PREFLIGHT="swift run --skip-build -- preflight"
FORMATTER="${1:-pretty}"

if git rev-parse --verify HEAD >/dev/null 2>&1
then
    { git diff HEAD & git ls-files --others --exclude-standard | xargs -n 1 git diff /dev/null; } | \
    $PREFLIGHT --diff git --output "$FORMATTER" --strict
else
    $PREFLIGHT --output "$FORMATTER" --strict
fi
